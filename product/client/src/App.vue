<template>
	<div>
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<div class="container-fluid">
				<a class="navbar-brand" href="#">Soldout</a>
				<button
					class="navbar-toggler"
					type="button"
					data-bs-toggle="collapse"
					data-bs-target="#navbarSupportedContent"
					aria-controls="navbarSupportedContent"
					aria-expanded="false"
					aria-label="Toggle navigation"
				>
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarSupportedContent">
					<ul class="navbar-nav me-auto mb-2 mb-lg-0">
						<li class="nav-item">
							<router-link class="nav-link" to="/">홈</router-link>
						</li>
						<li class="nav-item">
							<router-link class="nav-link active" to="/">
								제품리스트
							</router-link>
						</li>
						<li class="nav-item">
							<router-link class="nav-link" to="/detail">
								제품상세페이지
							</router-link>
						</li>
						<li class="nav-item">
							<router-link class="nav-link" to="/create">
								제품등록페이지
							</router-link>
						</li>
						<li v-if="user.email == undefined">
							<button class="btn btn-danger" type="button" @click="kakaoLogin">
								로그인
							</button>
						</li>
						<li v-else>빡큐</li>
						<li>
							<button class="btn btn-danger" type="button" @click="kakaoLogout">
								로그아웃
							</button>
						</li>
					</ul>
					<form class="d-flex">
						<input
							class="form-control me-2"
							type="search"
							placeholder="Search"
							aria-label="Search"
						/>
						<button class="btn btn-outline-success" type="submit">
							Search
						</button>
					</form>
				</div>
			</div>
		</nav>
		<router-view />

		<footer class="mt-5 py-5 bg-dark">
			<div class="row">
				<div class="col-12 col-md">
					<svg
						xmlns="http://www.w3.org/2000/svg"
						width="24"
						height="24"
						fill="none"
						stroke="currentColor"
						stroke-linecap="round"
						stroke-linejoin="round"
						stroke-width="2"
						class="d-block mb-2"
						role="img"
						viewBox="0 0 24 24"
					>
						<title>Product</title>
						<circle cx="12" cy="12" r="10" />
						<path
							d="M14.31 8l5.74 9.94M9.69 8h11.48M7.38 12l5.74-9.94M9.69 16L3.95 6.06M14.31 16H2.83m13.79-4l-5.74 9.94"
						/>
					</svg>
					<small class="d-block mb-3 text-muted">&copy; 2017-2020</small>
				</div>
				<div class="col-6 col-md">
					<h5>Features</h5>
					<ul class="list-unstyled text-small">
						<li>
							<a class="link-secondary" href="#">Cool stuff</a>
						</li>
						<li><a class="link-secondary" href="#">Random feature</a></li>
						<li><a class="link-secondary" href="#">Team feature</a></li>
						<li><a class="link-secondary" href="#">Stuff for developers</a></li>
						<li><a class="link-secondary" href="#">Another one</a></li>
						<li><a class="link-secondary" href="#">Last time</a></li>
					</ul>
				</div>
				<div class="col-6 col-md">
					<h5>Resources</h5>
					<ul class="list-unstyled text-small">
						<li><a class="link-secondary" href="#">Resource name</a></li>
						<li><a class="link-secondary" href="#">Resource</a></li>
						<li><a class="link-secondary" href="#">Another resource</a></li>
						<li><a class="link-secondary" href="#">Final resource</a></li>
					</ul>
				</div>
				<div class="col-6 col-md">
					<h5>Resources</h5>
					<ul class="list-unstyled text-small">
						<li><a class="link-secondary" href="#">Business</a></li>
						<li><a class="link-secondary" href="#">Education</a></li>
						<li><a class="link-secondary" href="#">Government</a></li>
						<li><a class="link-secondary" href="#">Gaming</a></li>
					</ul>
				</div>
				<div class="col-6 col-md">
					<h5>About</h5>
					<ul class="list-unstyled text-small">
						<li><a class="link-secondary" href="#">Team</a></li>
						<li><a class="link-secondary" href="#">Locations</a></li>
						<li><a class="link-secondary" href="#">Privacy</a></li>
						<li><a class="link-secondary" href="#">Terms</a></li>
					</ul>
				</div>
			</div>
		</footer>
	</div>
</template>
<script>
export default {
	computed: {
		user() {
			return this.$store.state.user;
		}
	},
	methods: {
		getProfile(authObj) {
			console.log(authObj);
			window.Kakao.API.request({
				url: "/v2/user/me",
				success: (res) => {
					let kakao_account = res.kakao_account;
					console.log(kakao_account);
					this.login(kakao_account);
					alert("로그인 성공!");
				}
			});
		},
		kakaoLogin() {
			window.Kakao.Auth.login({
				scope: "profile_nickname, account_email, gender",
				success: this.getProfile
			});
		},
		async login(kakao_account) {
			await this.$api("/api/login", {
				param: [
					{
						email: kakao_account.email,
						nickname: kakao_account.profile.nickname
					},
					{nickname: kakao_account.profile.nickname}
				]
			});

			this.$store.commit("user", kakao_account);
		},
		kakaoLogout() {
			window.Kakao.Auth.logout((response) => {
				console.log(response);
				this.$store.commit("user", {});
				alert("로그아웃");
				this.$router.push({path: "/"});
			});
		}
	}
};
</script>
<style>
#app {
	font-family: Avenir, Helvetica, Arial, sans-serif;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
	text-align: center;
	color: #2c3e50;
}

#nav {
	padding: 30px;
}

#nav a {
	font-weight: bold;
	color: #2c3e50;
}

#nav a.router-link-exact-active {
	color: #42b983;
}
</style>
